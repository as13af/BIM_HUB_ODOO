<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <!-- Tree View for BIM Documents -->
  <record id="view_bim_document_tree" model="ir.ui.view">
    <field name="name">bim.document.tree</field>
    <field name="model">bim.document</field>
    <field name="arch" type="xml">
      <tree string="BIM Documents" editable="bottom">
        <field name="name"/>
        <field name="project_id"/>
        <field name="file_type"/>
        <field name="revision"/>
        <field name="status" widget="statusbar"
               statusbar_visible="draft,to_review,approved,rejected"/>
        <field name="created_by"/>
        <field name="created_date"/>
        <field name="is_overdue"/>
      </tree>
    </field>
  </record>

  <!-- Form View for BIM Document -->
  <record id="view_bim_document_form" model="ir.ui.view">
    <field name="name">bim.document.form</field>
    <field name="model">bim.document</field>
    <field name="arch" type="xml">
      <form string="BIM Document">
        <header>
          <!-- Workflow Buttons -->
          <button name="action_request_review" type="object" string="Request Review"
                  class="btn-primary"
                  attrs="{'invisible': [('status', '!=', 'draft')]}"/>
          <button name="action_approve" type="object" string="Approve"
                  class="btn-success"
                  attrs="{'invisible': [('status', '!=', 'to_review')]}"/>
          <button name="action_reject" type="object" string="Reject"
                  class="btn-danger"
                  attrs="{'invisible': [('status', '!=', 'to_review')]}"/>
          <field name="status" widget="statusbar"
                 statusbar_visible="draft,to_review,approved,rejected"/>
        </header>
        <sheet>
          <group>
            <group>
              <field name="name"/>
              <field name="project_id"/>
              <field name="revision" readonly="1"/>
            </group>
            <group>
              <field name="file_name"/>
              <field name="file" filename="file_name"/>
              <field name="file_type"/>
            </group>
          </group>
          <group>
            <field name="classification_code"/>
            <field name="classification_name" readonly="1"/>
            <field name="classification_description" readonly="1"/>
          </group>
          <!-- Metrics Bar -->
          <group>
            <field name="days_since_creation" readonly="1"/>
            <field name="days_since_modification" readonly="1"/>
            <field name="is_overdue" readonly="1"/>
            <field name="approval_duration" readonly="1"
                   widget="progressbar" options="{'max_value': 10}"/>
          </group>
          <notebook>
            <page string="Description">
              <field name="description"/>
            </page>
            <page string="Revision History">
              <field name="revision_history_ids">
                <tree>
                  <field name="revision"/>
                  <field name="updated_by"/>
                  <field name="updated_date"/>
                </tree>
              </field>
            </page>
            <page string="Comments">
              <field name="comments">
                <tree string="Comments" editable="bottom">
                  <field name="author_id"/>
                  <field name="status" widget="statusbar"
                         statusbar_visible="open,resolved,closed"/>
                  <field name="comment" widget="mail_thread_message_short"/>
                  <field name="attachment_name"/>
                  <field name="create_date"/>
                </tree>
                <form string="Comment">
                  <sheet>
                    <group>
                      <field name="author_id" readonly="1"/>
                      <field name="status" widget="statusbar"
                             statusbar_visible="open,resolved,closed"/>
                      <field name="parent_comment_id"/>
                      <field name="create_date" readonly="1"/>
                    </group>
                    <group>
                      <field name="comment"/>
                      <field name="attachment" filename="attachment_name"/>
                    </group>
                    <div class="oe_chatter">
                      <field name="message_follower_ids" widget="mail_followers"/>
                      <field name="message_ids" widget="mail_thread"/>
                    </div>
                  </sheet>
                </form>
              </field>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Kanban View for BIM Documents -->
  <record id="view_bim_document_kanban" model="ir.ui.view">
    <field name="name">bim.document.kanban</field>
    <field name="model">bim.document</field>
    <field name="arch" type="xml">
      <kanban class="o_kanban_record">
        <field name="name"/>
        <field name="file_type"/>
        <field name="status"/>
        <field name="approval_duration"/>
        <templates>
          <t t-name="kanban-box">
            <div t-attf-class="oe_kanban_global_click o_kanban_record #{record.status.raw_value}">
              <div class="o_kanban_header">
                <strong><field name="name"/></strong>
                <div class="o_tag o_tag_color_1">
                  <field name="file_type"/>
                </div>
              </div>
              <div class="o_kanban_body">
                <div>Status: <field name="status"/></div>
                <div>Rev: <field name="revision"/></div>
                <div>
                  <field name="approval_duration" widget="progressbar"
                         options="{'max_value': 10}"/>
                  <small>days to approve</small>
                </div>
                <div t-if="record.is_overdue.raw_value">
                  ⚠️ <em>Overdue review</em>
                </div>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <!-- Action for BIM Documents -->
  <record id="action_bim_document" model="ir.actions.act_window">
    <field name="name">BIM Documents</field>
    <field name="res_model">bim.document</field>
    <field name="view_mode">kanban,tree,form</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Upload and manage your BIM documents here.
      </p>
    </field>
  </record>

  <!-- Menu Items -->
  <menuitem id="menu_bim_root" name="BIM Hub Odoo" sequence="10"/>
  <menuitem id="menu_bim_document_root" name="Documents" parent="menu_bim_root" sequence="3"/>
  <menuitem id="menu_bim_document" name="Manage Documents"
            parent="menu_bim_document_root" action="action_bim_document" sequence="1"/>

</odoo>
